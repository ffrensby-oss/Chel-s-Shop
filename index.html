<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mi Tienda</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --cream:#fff0f5; --dark:#5a3a4a; --accent:#e8789a;
    --gold:#f4a7bb; --card:#fff; --muted:#b08898;
    --nav:#fce4ec; --rose-deep:#d45f82;
  }
  *{margin:0;padding:0;box-sizing:border-box;}
  body{font-family:'DM Sans',sans-serif;background:var(--cream);color:var(--dark);min-height:100vh;}

  /* NAV */
  nav{background:var(--nav);border-bottom:1px solid #f4c2d0;padding:1rem 2rem;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:100;gap:1rem;}
  .logo{font-family:'Playfair Display',serif;color:var(--rose-deep);font-size:1.6rem;letter-spacing:2px;white-space:nowrap;cursor:default;user-select:none;-webkit-user-select:none;}
  .nav-right{display:flex;gap:.6rem;align-items:center;}
  .btn{border:none;padding:.5rem 1.2rem;border-radius:20px;cursor:pointer;font-family:'DM Sans',sans-serif;font-weight:500;transition:opacity .2s;font-size:.9rem;}
  .btn-accent{background:var(--accent);color:white;}
  .btn-outline{background:transparent;color:var(--rose-deep);border:1px solid var(--rose-deep);}
  .btn:hover{opacity:.82;}
  #badge-admin{background:var(--accent);color:white;padding:.25rem .7rem;border-radius:100px;font-size:.78rem;font-weight:600;}

  /* HERO */
  .hero{text-align:center;padding:4rem 2rem 2rem;background:linear-gradient(180deg,#fff0f5 0%,#fff 100%);}
  .hero h1{font-family:'Playfair Display',serif;font-size:clamp(2.5rem,6vw,4.5rem);font-weight:900;line-height:1.1;color:var(--dark);}
  .hero h1 span{color:var(--accent);}
  .hero p{color:var(--muted);margin-top:.8rem;font-size:1.05rem;}

  /* FILTROS */
  .filtros{display:flex;gap:.5rem;justify-content:center;padding:1.5rem 2rem;flex-wrap:wrap;}
  .filtro-btn{background:white;border:2px solid #f4c2d0;padding:.4rem 1.2rem;border-radius:100px;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:.9rem;transition:all .2s;color:var(--dark);}
  .filtro-btn.active,.filtro-btn:hover{background:var(--accent);color:white;border-color:var(--accent);}

  /* GRID */
  .grid-productos{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:1.5rem;padding:1rem 2rem 4rem;max-width:1200px;margin:0 auto;}
  .producto-card{background:var(--card);border-radius:20px;overflow:hidden;box-shadow:0 4px 18px rgba(232,120,154,.13);transition:transform .25s,box-shadow .25s;animation:fadeUp .4s ease both;position:relative;border:1px solid #fce4ec;}
  .producto-card:hover{transform:translateY(-5px);box-shadow:0 10px 30px rgba(232,120,154,.22);}
  @keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}

  .producto-img{width:100%;height:200px;object-fit:cover;display:block;}
  .producto-img-placeholder{width:100%;height:200px;background:linear-gradient(135deg,#fce4ec,#f8bbd0);display:flex;align-items:center;justify-content:center;font-size:3rem;color:var(--muted);}
  .producto-info{padding:1rem 1.2rem 1.4rem;}
  .producto-badge{display:inline-block;font-size:.72rem;font-weight:500;padding:.2rem .6rem;border-radius:100px;margin-bottom:.5rem;text-transform:uppercase;letter-spacing:.5px;}
  .badge-disponible{background:#e8f5e9;color:#2e7d32;}
  .badge-agotado{background:#fce4ec;color:#c2185b;}
  .producto-nombre{font-family:'Playfair Display',serif;font-size:1.15rem;font-weight:700;margin-bottom:.3rem;color:var(--dark);}
  .producto-precio{font-size:1.3rem;font-weight:500;color:var(--rose-deep);}

  /* Botones admin sobre tarjeta */
  .card-admin-btns{display:none;position:absolute;top:.6rem;right:.6rem;gap:.4rem;}
  .admin-logged .card-admin-btns{display:flex;}
  .card-btn{background:rgba(255,255,255,.92);color:var(--dark);border:1px solid #f4c2d0;padding:.4rem .7rem;border-radius:20px;cursor:pointer;font-size:.78rem;transition:all .2s;backdrop-filter:blur(4px);font-family:'DM Sans',sans-serif;}
  .card-btn:hover{background:var(--accent);color:white;border-color:var(--accent);}
  .card-btn.danger:hover{background:#e53e3e;border-color:#e53e3e;}

  .vacio{grid-column:1/-1;text-align:center;padding:4rem;color:var(--muted);font-size:1.1rem;}

  /* OVERLAYS */
  .overlay{display:none;position:fixed;inset:0;background:rgba(90,58,74,.45);z-index:200;align-items:center;justify-content:center;padding:1rem;}
  .overlay.open{display:flex;}
  .panel{background:white;border-radius:24px;width:100%;max-width:500px;max-height:90vh;overflow-y:auto;padding:2rem;position:relative;animation:slideIn .3s ease;border:1px solid #fce4ec;}
  .panel.narrow{max-width:370px;}
  @keyframes slideIn{from{transform:translateY(30px);opacity:0}to{transform:translateY(0);opacity:1}}

  .panel-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;}
  .panel-header h2{font-family:'Playfair Display',serif;font-size:1.5rem;color:var(--dark);}
  .close-btn{background:none;border:none;font-size:1.5rem;cursor:pointer;color:var(--muted);line-height:1;}

  /* FORM */
  .form-group{margin-bottom:1.2rem;}
  .form-group label{display:block;font-weight:500;font-size:.9rem;margin-bottom:.4rem;color:var(--dark);}
  .form-group input,.form-group select{width:100%;padding:.7rem .9rem;border:2px solid #fce4ec;border-radius:12px;font-family:'DM Sans',sans-serif;font-size:1rem;transition:border-color .2s;background:#fff9fb;}
  .form-group input:focus,.form-group select:focus{outline:none;border-color:var(--accent);}
  .form-error{color:#e53e3e;font-size:.82rem;margin-top:.4rem;display:none;}

  .upload-area{border:2px dashed #f4c2d0;border-radius:12px;padding:1.5rem;text-align:center;cursor:pointer;transition:all .2s;background:#fff9fb;}
  .upload-area:hover,.upload-area:active{border-color:var(--accent);background:#fff0f5;}
  .upload-area input{display:none;}
  .upload-preview{width:100%;max-height:160px;object-fit:cover;border-radius:10px;margin-top:.8rem;display:none;}

  .btn-full{width:100%;background:var(--accent);color:white;border:none;padding:.9rem;border-radius:12px;font-family:'DM Sans',sans-serif;font-size:1rem;font-weight:500;cursor:pointer;transition:opacity .2s;margin-top:.5rem;}
  .btn-full:hover{opacity:.88;}
  .btn-full.secondary{background:var(--dark);margin-top:.6rem;}

  /* LISTA ADMIN */
  .sep{display:flex;align-items:center;gap:.8rem;margin:1.4rem 0 1rem;color:var(--muted);font-size:.82rem;}
  .sep::before,.sep::after{content:'';flex:1;height:1px;background:#fce4ec;}
  .item-admin{display:flex;align-items:center;gap:.8rem;padding:.6rem 0;border-bottom:1px solid #fff0f5;}
  .item-admin-img{width:44px;height:44px;border-radius:10px;background:#fce4ec;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:1.2rem;overflow:hidden;}
  .item-admin-img img{width:100%;height:100%;object-fit:cover;}
  .item-admin-info{flex:1;font-size:.9rem;min-width:0;}
  .item-admin-info strong{display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:var(--dark);}
  .item-admin-info span{color:var(--muted);font-size:.8rem;}
  .item-admin-actions{display:flex;gap:.3rem;flex-shrink:0;}
  .icon-btn{background:none;border:none;cursor:pointer;font-size:1rem;padding:.4rem;border-radius:8px;transition:background .2s;}
  .icon-btn.edit:hover{background:#fce4ec;}
  .icon-btn.del:hover{background:#fff5f5;}

  /* Puntitos toque secreto */
  .tap-dot{position:fixed;width:14px;height:14px;border-radius:50%;background:var(--accent);opacity:.7;pointer-events:none;transform:translate(-50%,-50%);animation:tapPop .5s ease forwards;z-index:9999;}
  @keyframes tapPop{0%{transform:translate(-50%,-50%) scale(0);opacity:.8}60%{transform:translate(-50%,-50%) scale(1.6);opacity:.3}100%{transform:translate(-50%,-50%) scale(1);opacity:0}}

  /* Contador toque secreto */
  #tap-contador{display:none;position:fixed;bottom:1.5rem;left:50%;transform:translateX(-50%);background:var(--rose-deep);color:white;padding:.4rem 1.1rem;border-radius:100px;font-size:.85rem;font-family:'DM Sans',sans-serif;z-index:9999;pointer-events:none;transition:opacity .3s;}

  /* LOGIN */
  .lock-icon{font-size:3rem;text-align:center;margin-bottom:1rem;}
  .login-hint{font-size:.78rem;color:var(--muted);text-align:center;margin-top:.9rem;line-height:1.6;}

  /* TOAST */
  .toast{position:fixed;bottom:2rem;right:2rem;background:var(--rose-deep);color:white;padding:.8rem 1.4rem;border-radius:12px;font-size:.95rem;transform:translateY(100px);opacity:0;transition:all .3s;z-index:9998;max-width:300px;}
  .toast.show{transform:translateY(0);opacity:1;}

  /* SPINNER */
  .loading-overlay{display:none;position:fixed;inset:0;background:rgba(255,240,245,.75);z-index:500;align-items:center;justify-content:center;}
  .loading-overlay.show{display:flex;}
  .spinner{width:40px;height:40px;border:4px solid #fce4ec;border-top-color:var(--accent);border-radius:50%;animation:spin .7s linear infinite;}
  .spinner-inline{width:28px;height:28px;border:3px solid #fce4ec;border-top-color:var(--accent);border-radius:50%;animation:spin .7s linear infinite;margin:2rem auto;}
  @keyframes spin{to{transform:rotate(360deg)}}

  @media(max-width:480px){
    .grid-productos{padding:1rem;gap:1rem;}
    nav{padding:.8rem 1rem;}
    .logo{font-size:1.2rem;}
  }
</style>
</head>
<body>

<nav>
  <div class="logo" id="logo-secreto">CHEL'S SHOP</div>
  <div class="nav-right">
    <span id="badge-admin" style="display:none">ğŸŒ¸ Admin</span>
    <button class="btn btn-outline" id="btn-logout" style="display:none" onclick="cerrarSesion()">Salir</button>
    <button class="btn btn-accent" id="btn-panel-nav" style="display:none" onclick="abrirPanel()">âš™ï¸ Panel</button>
  </div>
</nav>

<div class="hero">
  <h1>Nuestra <span>ColecciÃ³n</span></h1>
  <p>Productos seleccionados con cuidado para ti</p>
</div>

<div class="filtros">
  <button class="filtro-btn active" onclick="filtrar('todos',this)">Todos</button>
  <button class="filtro-btn" onclick="filtrar('disponible',this)">Disponibles</button>
  <button class="filtro-btn" onclick="filtrar('agotado',this)">Agotados</button>
</div>

<div class="grid-productos" id="grid">
  <div style="grid-column:1/-1;text-align:center;padding:3rem;">
    <div class="spinner-inline"></div>
    <p style="color:var(--muted)">Cargando productos...</p>
  </div>
</div>

<div class="loading-overlay" id="loading-overlay">
  <div class="spinner"></div>
</div>

<!-- LOGIN -->
<div class="overlay" id="overlay-login" onclick="cerrarSi(event,'overlay-login')">
  <div class="panel narrow">
    <div class="panel-header">
      <h2>Acceso Admin</h2>
      <button class="close-btn" onclick="cerrarOverlay('overlay-login')">âœ•</button>
    </div>
    <div class="lock-icon">ğŸ”’</div>
    <div class="form-group">
      <label>Usuario</label>
      <input type="text" id="inp-user" placeholder="admin" autocomplete="username">
    </div>
    <div class="form-group">
      <label>ContraseÃ±a</label>
      <input type="password" id="inp-pass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password"
             onkeydown="if(event.key==='Enter')iniciarSesion()">
      <div class="form-error" id="login-error">Usuario o contraseÃ±a incorrectos.</div>
    </div>
    <button class="btn-full" onclick="iniciarSesion()">Entrar</button>
    <p class="login-hint"><em>Cambia las credenciales en el cÃ³digo antes de publicar.</em></p>
  </div>
</div>

<!-- PANEL ADMIN -->
<div class="overlay" id="overlay-panel" onclick="cerrarSi(event,'overlay-panel')">
  <div class="panel">
    <div class="panel-header">
      <h2 id="panel-titulo">Agregar producto</h2>
      <button class="close-btn" onclick="cerrarOverlay('overlay-panel')">âœ•</button>
    </div>
    <input type="hidden" id="edit-id">
    <div class="form-group">
      <label>Nombre del producto *</label>
      <input type="text" id="inp-nombre" placeholder="Ej: Bolso de cuero rosa">
    </div>
    <div class="form-group">
      <label>Precio *</label>
      <input type="number" id="inp-precio" placeholder="0.00" min="0" step="0.01">
    </div>
    <div class="form-group">
      <label>Disponibilidad</label>
      <select id="inp-disp">
        <option value="disponible">âœ… Disponible</option>
        <option value="agotado">âŒ Agotado</option>
      </select>
    </div>
    <div class="form-group">
      <label>Foto del producto</label>
      <div class="upload-area" onclick="document.getElementById('inp-foto').click()">
        <span id="upload-text">ğŸ“· Toca aquÃ­ para subir una foto</span>
        <input type="file" id="inp-foto" accept="image/*" onchange="previsualizarFoto(event)">
        <img class="upload-preview" id="foto-preview" alt="">
      </div>
    </div>
    <button class="btn-full" id="btn-guardar" onclick="guardarProducto()">+ Agregar Producto</button>
    <button class="btn-full secondary" id="btn-cancelar" style="display:none" onclick="cancelarEdicion()">âœ• Cancelar ediciÃ³n</button>
    <div class="sep">productos existentes</div>
    <div id="lista-admin"></div>
  </div>
</div>

<div class="toast" id="toast"></div>
<div id="tap-contador">ğŸŒ¸ <span id="tap-num">0</span>/3</div>

<script>
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SUPABASE CONFIG
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  const SUPA_URL = 'https://biwhblujvlhvdhlxgabt.supabase.co';
  const SUPA_KEY = 'sb_publishable_HV1KAe9scUJzefWQdTgEHg_DnU8vecX';

  async function supaFetch(path, options = {}) {
    const res = await fetch(SUPA_URL + '/rest/v1/' + path, {
      headers: {
        'apikey': SUPA_KEY,
        'Authorization': 'Bearer ' + SUPA_KEY,
        'Content-Type': 'application/json',
        'Prefer': options.prefer || 'return=representation',
        ...options.headers
      },
      ...options
    });
    if (!res.ok) {
      const err = await res.text();
      throw new Error(err);
    }
    const text = await res.text();
    return text ? JSON.parse(text) : [];
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ADMIN CONFIG
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  const ADMIN_USER = 'admin';
  const ADMIN_PASS = '1234'; // â† cÃ¡mbiala antes de publicar

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ESTADO
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  let productos    = [];
  let filtroActivo = 'todos';
  let fotoBase64   = '';
  let adminOk      = sessionStorage.getItem('elara-admin') === '1';

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // CARGAR PRODUCTOS
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  async function cargarProductos() {
    try {
      const data = await supaFetch('productos?select=*&order=creado.desc');
      productos = data;
      renderGrid(filtroActivo);
      renderLista();
    } catch(e) {
      console.error(e);
      document.getElementById('grid').innerHTML =
        '<div class="vacio">âŒ Error al cargar productos. Verifica tu conexiÃ³n.</div>';
    }
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // AUTH
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function iniciarSesion() {
    const u   = document.getElementById('inp-user').value.trim();
    const p   = document.getElementById('inp-pass').value;
    const err = document.getElementById('login-error');
    if (u === ADMIN_USER && p === ADMIN_PASS) {
      adminOk = true;
      sessionStorage.setItem('elara-admin','1');
      err.style.display = 'none';
      cerrarOverlay('overlay-login');
      refrescarNav();
      renderGrid(filtroActivo);
      toast('ğŸ‘‹ Bienvenida, Admin ğŸŒ¸');
      document.getElementById('inp-pass').value = '';
      document.getElementById('inp-user').value = '';
    } else {
      err.style.display = 'block';
      document.getElementById('inp-pass').value = '';
      document.getElementById('inp-pass').focus();
    }
  }

  function cerrarSesion() {
    adminOk = false;
    sessionStorage.removeItem('elara-admin');
    refrescarNav();
    renderGrid(filtroActivo);
    toast('ğŸ‘‹ SesiÃ³n cerrada');
  }

  function refrescarNav() {
    document.getElementById('badge-admin').style.display   = adminOk ? 'inline'      : 'none';
    document.getElementById('btn-logout').style.display    = adminOk ? 'inline-block' : 'none';
    document.getElementById('btn-panel-nav').style.display = adminOk ? 'inline-block' : 'none';
    document.body.classList.toggle('admin-logged', adminOk);
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // RENDER GRID
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function renderGrid(filtro = 'todos') {
    const grid  = document.getElementById('grid');
    const lista = filtro === 'todos' ? productos : productos.filter(p => p.disponibilidad === filtro);
    if (!lista.length) {
      grid.innerHTML = '<div class="vacio">âœ¨ No hay productos en esta categorÃ­a.</div>';
      return;
    }
    grid.innerHTML = lista.map((p, i) => `
      <div class="producto-card" style="animation-delay:${i * .07}s">
        ${p.foto
          ? `<img class="producto-img" src="${p.foto}" alt="${p.nombre}">`
          : '<div class="producto-img-placeholder">ğŸ›ï¸</div>'}
        <div class="card-admin-btns">
          <button class="card-btn"        onclick="editarProducto('${p.id}')">âœï¸ Editar</button>
          <button class="card-btn danger" onclick="eliminarProducto('${p.id}')">ğŸ—‘ Borrar</button>
        </div>
        <div class="producto-info">
          <span class="producto-badge badge-${p.disponibilidad}">
            ${p.disponibilidad === 'disponible' ? 'âœ… Disponible' : 'âŒ Agotado'}
          </span>
          <div class="producto-nombre">${p.nombre}</div>
          <div class="producto-precio">$${parseFloat(p.precio).toFixed(2)}</div>
        </div>
      </div>`).join('');
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // RENDER LISTA ADMIN
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function renderLista() {
    const div = document.getElementById('lista-admin');
    if (!productos.length) {
      div.innerHTML = '<p style="color:var(--muted);font-size:.9rem;text-align:center;padding:1rem">Sin productos aÃºn.</p>';
      return;
    }
    div.innerHTML = productos.map(p => `
      <div class="item-admin">
        <div class="item-admin-img">${p.foto ? `<img src="${p.foto}" alt="">` : 'ğŸ›ï¸'}</div>
        <div class="item-admin-info">
          <strong>${p.nombre}</strong>
          <span>$${parseFloat(p.precio).toFixed(2)} Â· ${p.disponibilidad}</span>
        </div>
        <div class="item-admin-actions">
          <button class="icon-btn edit" onclick="editarProducto('${p.id}')"   title="Editar">âœï¸</button>
          <button class="icon-btn del"  onclick="eliminarProducto('${p.id}')" title="Eliminar">ğŸ—‘</button>
        </div>
      </div>`).join('');
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // CRUD â€” SUPABASE
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  async function guardarProducto() {
    const nombre = document.getElementById('inp-nombre').value.trim();
    const precio = parseFloat(document.getElementById('inp-precio').value);
    const disp   = document.getElementById('inp-disp').value;
    const editId = document.getElementById('edit-id').value;

    if (!nombre)           return toast('âš ï¸ Ingresa el nombre del producto');
    if (!precio || precio <= 0) return toast('âš ï¸ Ingresa un precio vÃ¡lido');

    mostrarCarga(true);
    try {
      if (editId) {
        const datos = { nombre, precio, disponibilidad: disp };
        if (fotoBase64) datos.foto = fotoBase64;
        await supaFetch(`productos?id=eq.${editId}`, {
          method: 'PATCH',
          body: JSON.stringify(datos)
        });
        cancelarEdicion();
        toast('âœ… Producto actualizado');
      } else {
        await supaFetch('productos', {
          method: 'POST',
          body: JSON.stringify({
            nombre, precio,
            disponibilidad: disp,
            foto: fotoBase64 || null,
            creado: Date.now()
          })
        });
        limpiarForm();
        toast('âœ… Producto agregado ğŸŒ¸');
      }
      await cargarProductos();
    } catch(e) {
      console.error(e);
      toast('âŒ Error al guardar. Verifica tu conexiÃ³n.');
    }
    mostrarCarga(false);
  }

  function editarProducto(id) {
    const p = productos.find(x => x.id === id);
    if (!p) return;
    document.getElementById('edit-id').value    = p.id;
    document.getElementById('inp-nombre').value = p.nombre;
    document.getElementById('inp-precio').value = p.precio;
    document.getElementById('inp-disp').value   = p.disponibilidad;
    document.getElementById('panel-titulo').textContent = 'âœï¸ Editar producto';
    document.getElementById('btn-guardar').textContent  = 'Guardar cambios';
    document.getElementById('btn-cancelar').style.display = 'block';
    if (p.foto) {
      fotoBase64 = p.foto;
      const prev = document.getElementById('foto-preview');
      prev.src = p.foto; prev.style.display = 'block';
      document.getElementById('upload-text').textContent = 'ğŸ”„ Foto actual (cambia si deseas)';
    }
    abrirPanel();
    setTimeout(() => document.querySelector('#overlay-panel .panel').scrollTop = 0, 50);
  }

  async function eliminarProducto(id) {
    if (!confirm('Â¿Eliminar este producto permanentemente?')) return;
    mostrarCarga(true);
    try {
      await supaFetch(`productos?id=eq.${id}`, {
        method: 'DELETE',
        prefer: 'return=minimal'
      });
      toast('ğŸ—‘ Producto eliminado');
      await cargarProductos();
    } catch(e) {
      toast('âŒ Error al eliminar');
    }
    mostrarCarga(false);
  }

  function cancelarEdicion() {
    document.getElementById('edit-id').value = '';
    document.getElementById('panel-titulo').textContent = 'Agregar producto';
    document.getElementById('btn-guardar').textContent  = '+ Agregar Producto';
    document.getElementById('btn-cancelar').style.display = 'none';
    limpiarForm();
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // FOTO
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function previsualizarFoto(e) {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = ev => {
      fotoBase64 = ev.target.result;
      const prev = document.getElementById('foto-preview');
      prev.src = fotoBase64; prev.style.display = 'block';
      document.getElementById('upload-text').textContent = 'âœ… ' + file.name;
    };
    reader.readAsDataURL(file);
  }

  function limpiarForm() {
    ['inp-nombre','inp-precio'].forEach(id => document.getElementById(id).value = '');
    document.getElementById('inp-disp').value = 'disponible';
    document.getElementById('inp-foto').value = '';
    document.getElementById('foto-preview').style.display = 'none';
    document.getElementById('upload-text').textContent = 'ğŸ“· Toca aquÃ­ para subir una foto';
    fotoBase64 = '';
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // FILTROS
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function filtrar(tipo, btn) {
    filtroActivo = tipo;
    document.querySelectorAll('.filtro-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    renderGrid(tipo);
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // OVERLAYS
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function abrirLogin() {
    abrirOverlay('overlay-login');
    setTimeout(() => document.getElementById('inp-user').focus(), 300);
  }
  function abrirPanel() {
    if (!adminOk) { abrirLogin(); return; }
    renderLista();
    abrirOverlay('overlay-panel');
  }
  function abrirOverlay(id)  { document.getElementById(id).classList.add('open'); }
  function cerrarOverlay(id) { document.getElementById(id).classList.remove('open'); }
  function cerrarSi(e, id)   { if (e.target.id === id) cerrarOverlay(id); }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // HELPERS
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function mostrarCarga(v) {
    document.getElementById('loading-overlay').classList.toggle('show', v);
  }
  function toast(msg) {
    const t = document.getElementById('toast');
    t.textContent = msg; t.classList.add('show');
    clearTimeout(t._t);
    t._t = setTimeout(() => t.classList.remove('show'), 3200);
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ACCESO SECRETO â€” 3 toques al logo
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  (function() {
    var count = 0, timer = null, hideTimer = null;

    function mostrarContador(n) {
      var el  = document.getElementById('tap-contador');
      var num = document.getElementById('tap-num');
      if (!el || !num) return;
      num.textContent = n;
      el.style.display = 'block';
      el.style.opacity = '1';
      clearTimeout(hideTimer);
      hideTimer = setTimeout(function() {
        el.style.opacity = '0';
        setTimeout(function() { el.style.display = 'none'; }, 300);
      }, 1200);
    }

    function onTap(e) {
      var x = e.clientX || (e.touches && e.touches[0] ? e.touches[0].clientX : 0);
      var y = e.clientY || (e.touches && e.touches[0] ? e.touches[0].clientY : 0);

      var dot = document.createElement('div');
      dot.className = 'tap-dot';
      dot.style.left = x + 'px';
      dot.style.top  = y + 'px';
      document.body.appendChild(dot);
      setTimeout(function() { dot.remove(); }, 500);

      count++;
      mostrarContador(count);
      clearTimeout(timer);
      timer = setTimeout(function() { count = 0; }, 2000);

      if (count >= 3) {
        count = 0;
        clearTimeout(timer);
        if (adminOk) abrirPanel();
        else abrirLogin();
      }
    }

    var logo = document.getElementById('logo-secreto');
    if (logo) {
      logo.addEventListener('click',      onTap, { passive: true });
      logo.addEventListener('touchstart', onTap, { passive: true });
    }
  })();

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // INIT
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  refrescarNav();
  cargarProductos();
</script>
</body>
</html>
